map_a:
  transforms:
    row:
      rename_keys:
        id: :record_id
        desc: :title
        total: :amount
      accept_keys:
        - :record_id
        - :title
        - :amount
    values:
      amount:
        - :to_decimal
        - :to_float
  source:
    bucket: "foo"
    key: "data.tsv"
    type: "csv"
    opts:
      col_sep: "\t"
      headers: true
  destination:
    bucket: "bar"
    key: "data.csv"
    type: "csv"
    opts:
      write_headers: false

map_b:
  transforms:
    row:
      rename_keys:
        id: :record_id
        desc: :title
        total: :amount
      accept_keys:
        - :record_id
        - :title
        - :amount
      set_default:
        title: "default_value"
        amount: "99"
  source:
    bucket: "foo"
    key: "data.tsv"
    type: "csv"
    opts:
      col_sep: "\t"
      headers: true
  destination:
    bucket: "bar"
    key: "data.csv"
    type: "csv"
    opts:
      headers:
        - :record_id
        - :title
        - :amount
      write_headers: true

zipped:
  transforms:
    row:
      rename_keys:
        AlbumTitle: :album_title
        AlbumArtist: :album_artist
        TrackArtist: :track_primary_artist
        TrackTitle: :track_title
        UPC: :album_upc
        TrackId: :track_id
        MarketingLabel: :service_offering
        Subscription: :subscription
        Partner: :partner
        TotalPerformances: :units
      accept_keys:
        - :album_title
        - :track_primary_artist
        - :track_title
        - :album_upc
        - :track_id
        - :service_offering
        - :units
        - :custom_fields
        - :album_artist
        - :subscription
        - :partner
      nest:
        - :custom_fields
        -
          - :album_artist
          - :subscription
          - :partner
    values:
      custom_fields:
        - :to_json
  source:
    bucket: "foo"
    key: "foo.zip"
    type: "csv"
    opts:
      col_sep: "\t"
      headers:
        - album_title
        - album_artist
        - track_primary_artist
        - track_title
        - album_upc
        - track_id
        - service_offering
        - subscription
        - partner
        - units
  destination:
    bucket: "bar"
    key: "bar.tsv"
    type: "csv"
    opts:
      col_sep: "\t"
      write_headers: false
      force_quotes: false
      quote_char: "\""
      headers:
        - :album_title
        - :track_primary_artist
        - :track_title
        - :album_upc
        - :track_id
        - :service_offering
        - :units
        - :custom_fields
